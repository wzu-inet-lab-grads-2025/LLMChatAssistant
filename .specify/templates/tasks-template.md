---
description: "功能实现任务列表模板"
---

# 任务: [FEATURE NAME]

**输入**: 来自 `/specs/[###-feature-name]/` 的设计文档
**前置条件**: plan.md(必需)、spec.md(用户故事必需)、research.md、data-model.md、contracts/

**测试**: 以下示例包含测试任务. 测试是可选的 - 仅在功能规范中明确要求时才包含.

**组织结构**: 任务按用户故事分组, 以便每个故事能够独立实施和测试.

## 格式: `[ID] [P?] [Story] 描述`
- **[P]**: 可以并行运行(不同文件, 无依赖关系)
- **[Story]**: 此任务属于哪个用户故事(例如: US1、US2、US3)
- 在描述中包含确切的文件路径

## 路径约定
- **单一项目**: 仓库根目录下的 `src/`、`tests/`
- **Web 应用**: `backend/src/`、`frontend/src/`
- **移动应用**: `api/src/`、`ios/src/` 或 `android/src/`
- 以下显示的路径假设为单一项目 - 根据 plan.md 结构进行调整

<!--
  ============================================================================
  重要说明: 以下任务仅为说明目的的示例任务.

  /speckit.tasks 命令必须根据以下内容替换为实际任务: 
  - 来自 spec.md 的用户故事(及其优先级 P1、P2、P3...)
  - 来自 plan.md 的功能需求
  - 来自 data-model.md 的实体
  - 来自 contracts/ 的端点

  任务必须按用户故事组织, 以便每个故事能够: 
  - 独立实施
  - 独立测试
  - 作为 MVP 增量交付

  不要在生成的 tasks.md 文件中保留这些示例任务.
  ============================================================================
-->

## 阶段 1: 设置(共享基础设施)

**目的**: 项目初始化和基本结构

- [ ] T001 根据实施计划创建项目结构
- [ ] T002 使用 uv 和 Python 3.11 初始化项目 (遵循章程: 开发环境标准)
- [ ] T003 [P] 配置代码检查和格式化工具
- [ ] T004 [P] 在 logs 文件夹中创建日志文件 (遵循章程: 文档与可追溯性)
- [ ] T005 [P] 如涉及 LLM,配置 zai-sdk 依赖 (遵循章程: 真实集成)
- [ ] T006 [P] 确保所有代码注释使用中文 (遵循章程: 语言规范)
- [ ] T007 [P] 确保错误消息和日志使用中文 (遵循章程: 语言规范)

---

## 阶段 1.5: 版本控制检查点

**目的**: 确保设置阶段完成并通过测试后进行版本提交

- [ ] T008 运行所有设置阶段的测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] T009 提交设置阶段代码,清晰描述设置工作和测试结果 (遵循章程: 版本控制与测试纪律)

---

## 阶段 2: 基础(阻塞前置条件)

**目的**: 在任何用户故事可以实施之前必须完成的核心基础设施

**⚠️ 关键**: 在此阶段完成之前, 无法开始任何用户故事工作

基础任务示例(根据你的项目调整):

- [ ] T006 设置数据库架构和迁移框架
- [ ] T007 [P] 实施身份验证/授权框架
- [ ] T008 [P] 设置 API 路由和中间件结构
- [ ] T009 创建所有故事依赖的基础模型/实体
- [ ] T010 配置错误处理和日志记录基础设施 (日志写入 logs 文件夹)
- [ ] T011 设置环境配置管理
- [ ] T012 如涉及 LLM,实现智谱 API key 验证机制 (遵循章程: 测试真实性)
- [ ] T013 [P] 如涉及文件访问,实施统一的路径白名单验证器 (遵循章程: 安全第一原则)
- [ ] T014 [P] 如涉及文件访问,配置路径黑名单保护敏感文件 (遵循章程: 安全第一原则)
- [ ] T015 [P] 如涉及 RAG 功能,实施索引管理器和懒加载策略 (遵循章程: 自动化与按需索引)
- [ ] T016 [P] 实施多层安全验证机制 (白名单、黑名单、大小限制、内容类型验证) (遵循章程: 多层防御策略)
- [ ] T017 配置审计日志记录 (文件访问、索引创建、工具调用) (遵循章程: 可审计性与透明性)

---

## 阶段 2.5: 版本控制检查点

**目的**: 确保基础设施阶段完成并通过测试后进行版本提交

- [ ] T018 运行所有基础设施阶段的测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] T019 提交基础设施阶段代码,清晰描述基础工作和测试结果 (遵循章程: 版本控制与测试纪律)

**检查点**: 基础就绪 - 现在可以开始并行实施用户故事

---

## 阶段 3: 用户故事 1 - [Title](优先级: P1)🎯 MVP

**目标**: [此故事交付内容的简要描述]

**独立测试**: [如何验证此故事独立运行]

### 用户故事 1 的测试(可选 - 仅在要求测试时)⚠️

**注意: 先编写这些测试, 确保在实施前它们失败**

- [ ] T020 [P] [US1] 在 tests/contract/test_[name].py 中为 [endpoint] 编写合约测试
- [ ] T021 [P] [US1] 在 tests/integration/test_[name].py 中为 [user journey] 编写集成测试

### 用户故事 1 的实施

- [ ] T022 [P] [US1] 在 src/models/[entity1].py 中创建 [Entity1] 模型
- [ ] T023 [P] [US1] 在 src/models/[entity2].py 中创建 [Entity2] 模型
- [ ] T024 [US1] 在 src/services/[service].py 中实施 [Service](依赖于 T022、T023)
- [ ] T025 [US1] 在 src/[location]/[file].py 中实施 [endpoint/feature]
- [ ] T026 [US1] 添加验证和错误处理
- [ ] T027 [US1] 为用户故事 1 操作添加日志记录

---

## 阶段 3.5: 版本控制检查点

**目的**: 确保用户故事 1 完成并通过测试后进行版本提交

- [ ] T028 运行用户故事 1 的所有测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] T029 提交用户故事 1 代码,清晰描述用户故事 1 的功能和测试结果 (遵循章程: 版本控制与测试纪律)

**检查点**: 此时, 用户故事 1 应该完全功能化且可独立测试

---

## 阶段 4: 用户故事 2 - [Title](优先级: P2)

**目标**: [此故事交付内容的简要描述]

**独立测试**: [如何验证此故事独立运行]

### 用户故事 2 的测试(可选 - 仅在要求测试时)⚠️

- [ ] T030 [P] [US2] 在 tests/contract/test_[name].py 中为 [endpoint] 编写合约测试
- [ ] T031 [P] [US2] 在 tests/integration/test_[name].py 中为 [user journey] 编写集成测试

### 用户故事 2 的实施

- [ ] T032 [P] [US2] 在 src/models/[entity].py 中创建 [Entity] 模型
- [ ] T033 [US2] 在 src/services/[service].py 中实施 [Service]
- [ ] T034 [US2] 在 src/[location]/[file].py 中实施 [endpoint/feature]
- [ ] T035 [US2] 与用户故事 1 组件集成(如需要)

---

## 阶段 4.5: 版本控制检查点

**目的**: 确保用户故事 2 完成并通过测试后进行版本提交

- [ ] T036 运行用户故事 2 的所有测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] T037 提交用户故事 2 代码,清晰描述用户故事 2 的功能和测试结果 (遵循章程: 版本控制与测试纪律)

**检查点**: 此时, 用户故事 1 和 2 都应该独立运行

---

## 阶段 5: 用户故事 3 - [Title](优先级: P3)

**目标**: [此故事交付内容的简要描述]

**独立测试**: [如何验证此故事独立运行]

### 用户故事 3 的测试(可选 - 仅在要求测试时)⚠️

- [ ] T040 [P] [US3] 在 tests/contract/test_[name].py 中为 [endpoint] 编写合约测试
- [ ] T041 [P] [US3] 在 tests/integration/test_[name].py 中为 [user journey] 编写集成测试

### 用户故事 3 的实施

- [ ] T042 [P] [US3] 在 src/models/[entity].py 中创建 [Entity] 模型
- [ ] T043 [US3] 在 src/services/[service].py 中实施 [Service]
- [ ] T044 [US3] 在 src/[location]/[file].py 中实施 [endpoint/feature]

---

## 阶段 5.5: 版本控制检查点

**目的**: 确保用户故事 3 完成并通过测试后进行版本提交

- [ ] T045 运行用户故事 3 的所有测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] T046 提交用户故事 3 代码,清晰描述用户故事 3 的功能和测试结果 (遵循章程: 版本控制与测试纪律)

**检查点**: 所有用户故事现在应该独立功能化

---

[根据需要添加更多用户故事阶段, 遵循相同模式]

---

## 阶段 N: 完善与横切关注点

**目的**: 影响多个用户故事的改进

- [ ] TXXX [P] 在 docs/ 中更新文档
- [ ] TXXX 代码清理和重构
- [ ] TXXX 跨所有故事的性能优化
- [ ] TXXX [P] 在 tests/unit/ 中添加额外的单元测试(如要求)
- [ ] TXXX 安全加固
- [ ] TXXX 运行 quickstart.md 验证

---

## 阶段 N.5: 版本控制检查点

**目的**: 确保完善阶段完成并通过测试后进行最终版本提交

- [ ] TXXX 运行所有测试,包括完善和横切关注点的测试,确保测试通过 (遵循章程: 版本控制与测试纪律)
- [ ] TXXX 提交完善阶段代码,清晰描述完善工作和最终的测试结果 (遵循章程: 版本控制与测试纪律)

---

## 依赖关系与执行顺序

### 阶段依赖关系

- **设置(阶段 1)**: 无依赖关系 - 可立即开始
- **基础(阶段 2)**: 依赖于设置完成 - 阻塞所有用户故事
- **用户故事(阶段 3+)**: 都依赖于基础阶段完成
  - 然后用户故事可以并行进行(如果有人员)
  - 或按优先级顺序进行(P1 → P2 → P3)
- **完善(最终阶段)**: 依赖于所有期望的用户故事完成

### 用户故事依赖关系

- **用户故事 1(P1)**: 可在基础(阶段 2)后开始 - 无其他故事依赖
- **用户故事 2(P2)**: 可在基础(阶段 2)后开始 - 可与 US1 集成但应独立可测试
- **用户故事 3(P3)**: 可在基础(阶段 2)后开始 - 可与 US1/US2 集成但应独立可测试

### 每个用户故事内部

- 测试(如包含)必须在实施前编写并失败
- 模型在服务之前
- 服务在端点之前
- 核心实施在集成之前
- 故事完成后才移至下一个优先级

### 并行机会

- 所有标记为 [P] 的设置任务可以并行运行
- 所有标记为 [P] 的基础任务可以并行运行(在阶段 2 内)
- 基础阶段完成后, 所有用户故事可以并行开始(如果团队容量允许)
- 用户故事中所有标记为 [P] 的测试可以并行运行
- 故事中标记为 [P] 的模型可以并行运行
- 不同用户故事可以由不同团队成员并行处理

---

## 并行示例: 用户故事 1

```bash
# 一起启动用户故事 1 的所有测试(如要求测试): 
任务: "在 tests/contract/test_[name].py 中为 [endpoint] 编写合约测试"
任务: "在 tests/integration/test_[name].py 中为 [user journey] 编写集成测试"

# 一起启动用户故事 1 的所有模型: 
任务: "在 src/models/[entity1].py 中创建 [Entity1] 模型"
任务: "在 src/models/[entity2].py 中创建 [Entity2] 模型"
```

---

## 实施策略

### 仅 MVP(仅用户故事 1)

1. 完成阶段 1: 设置
2. 完成阶段 2: 基础(关键 - 阻塞所有故事)
3. 完成阶段 3: 用户故事 1
4. **停止并验证**: 独立测试用户故事 1
5. 如准备好则部署/演示

### 增量交付

1. 完成设置 + 基础 → 基础就绪
2. 添加用户故事 1 → 独立测试 → 部署/演示(MVP! )
3. 添加用户故事 2 → 独立测试 → 部署/演示
4. 添加用户故事 3 → 独立测试 → 部署/演示
5. 每个故事在不破坏先前故事的情况下增加价值

### 并行团队策略

有多个开发人员时: 

1. 团队一起完成设置 + 基础
2. 基础完成后: 
   - 开发人员 A: 用户故事 1
   - 开发人员 B: 用户故事 2
   - 开发人员 C: 用户故事 3
3. 故事独立完成和集成

---

## 注意事项

- [P] 任务 = 不同文件, 无依赖关系
- [Story] 标签将任务映射到特定用户故事以实现可追溯性
- 每个用户故事应该独立可完成和可测试
- 在实施前验证测试失败
- 在每个任务或逻辑组后提交
- 在任何检查点停止以独立验证故事
- 避免: 模糊任务、相同文件冲突、破坏独立性的跨故事依赖

